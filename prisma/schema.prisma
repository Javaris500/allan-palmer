generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ═══════════════════════════════════════════════════════
// Enums
// ═══════════════════════════════════════════════════════

enum LessonType {
  PRIVATE
  GROUP
  MASTERCLASS
  ONLINE
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  ALL_LEVELS
}

enum BookingStatus {
  PENDING
  REVIEWED
  CONFIRMED
  COMPLETED
  CANCELLED
}

// ═══════════════════════════════════════════════════════
// Availability
// ═══════════════════════════════════════════════════════

model Availability {
  id          String      @id @default(cuid())
  dayOfWeek   Int         // 0=Sunday, 6=Saturday
  startTime   String      // "09:00"
  endTime     String      // "17:00"
  lessonType  LessonType?
  isAvailable Boolean     @default(true)

  @@map("availability")
}

// ═══════════════════════════════════════════════════════
// Event Bookings (authless — identified by contactEmail)
// ═══════════════════════════════════════════════════════

model Booking {
  id        String        @id @default(cuid())
  reference String        @unique // BK-20260215-A3F7
  status    BookingStatus @default(PENDING)

  // Event details (Phase 1)
  eventType      String
  eventDate      DateTime
  timePreference String   // Morning, Afternoon, Evening
  venue          String?
  guestCount     String?  // Under 50, 50-100, etc.
  setting        String?  // Indoor, Outdoor, Both

  // Performance details (Phase 2)
  duration            String   // 30 min, 1 hour, 2 hours, Custom
  musicStyles         String[]
  songRequests        String?  @db.Text
  specialRequirements String?  @db.Text

  // Contact details (Phase 3)
  contactName  String
  contactEmail String
  contactPhone String
  referralSource String?

  // Admin
  adminNotes String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  messages BookingMessage[]

  @@index([contactEmail])
  @@index([eventDate])
  @@index([status])
  @@map("bookings")
}

model BookingMessage {
  id        String   @id @default(cuid())
  bookingId String
  fromAdmin Boolean  @default(false)
  content   String   @db.Text
  createdAt DateTime @default(now())

  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@map("booking_messages")
}
